# countDistinctEstimation

The implementation of stream algorithm for estimating distinct count.

The algorithm is with an example of streaming input which is a sequence of multi-attribute metadata that corresponds to different jobs containing these columns

SourceIPAddress, ClusterId , JobId, Date, Geography
xxxx.xxxx.xxxx.xxxx, [0-99] , long64, DD:MM , [0-9]

# Implementation details

CountDistinctSketchAlgorithm generates and hold CountDistinctDataStructure which is a sketch of each attributes.

## Sketch Generation

1. The Sketch generation uses log(log(n)) algorithm and parameterized number of hash functions.
2. Each sketch for an attribute is generated with a random seed initialized hash function
3. The median of count generated by different 'h' sketches is the final count Distinct Estimate.
4. 2^R is the approximate number of items, like if there are 200 items R will 8, 2^8=256. 

### Algorithm Steps

1. Create a sketch

    2^1  --- -->  [, , , ] 
    2^2  --- -->  [ , , , ]
    2^3  ---  --> [, , , , ]
    .
    .
    2^64 --- --> [, , , , ]
    
    where each bucket has 2^R bit to turned on. Number buckets depend upon the hash function output. This solution uses long64 hash function hence 64 of these buckets.
    
  In the above T hash buckets the bits are turned on by using these steps
  
    consider
    
      z - 64 bit long hash output  z = hash_function("str")
      R - approx total values
      
       i. calculate trailing zeros
       
        /// if z = 12 R = 2^4
        /// z / R = 12 
        /// binary fo z = 1110 
        /// the number of trailing zeros = 1 - so value 12 goes into T = 2^1 - bucket
        
       ii. bit to turn on
       
        /// the leading prefix bits which are bits before trailing zeros are used to calculate the position to be turned on.
        /// z=12 binary = 1110, in this case it will first to bits 11, which is position 3 in our example.
    
    
    
  2. how the distinct count is estimated?
      
         i. For each hashfunction T estimate F0 as follows
            
             w*= arg.median( Tw[i] = 0)
             w* is the bucket where the count distinct estiamte lies.
             
             p0 = ( count(Tw*[i]=0) )/R;
             
             F0d =  (Math.log(p0)) / (Math.log( 1.0- (1.0/R) ));
             
             Median(F01 , F02 .... F0h) is the estimated count distinct value.
     
    
             
    
    
 A variation of what explained here - https://medium.com/@amitj975/an-efficient-way-of-calculating-distinct-count-over-a-data-hyperloglog-a7481f0fcf3d
 
 
